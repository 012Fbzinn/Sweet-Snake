<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Histórico • Sweet Snake</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0f1724, #111827);
      scroll-behavior: smooth;
    }

    .history-card {
      background: linear-gradient(145deg, #1f2937, #111827);
      padding: 1.8rem;
      border-radius: 1rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
      transition: transform 0.3s, box-shadow 0.3s, background 0.3s;
    }

    .history-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(119, 0, 255, 0.5);
      background: linear-gradient(145deg, #272e3c, #1b1f29);
    }

    .button-red {
      background: #dc2626;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-weight: 600;
      transition: all 0.3s;
    }

    .button-red:hover {
      background: #b91c1c;
      transform: scale(1.05);
    }

    .button-back {
      background: #374151;
      color: white;
      padding: 0.6rem 1.5rem;
      border-radius: 0.6rem;
      font-weight: 600;
      transition: all 0.3s;
    }

    .button-back:hover {
      background: #4b5563;
      transform: scale(1.05);
    }

    #popup-feedback {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 50;
      display: none;
      animation: fadeIn 0.3s ease forwards;
    }

    #popup-feedback .content {
      background: #1f2937;
      padding: 2.5rem;
      border-radius: 1.5rem;
      text-align: center;
      color: white;
      width: 90%;
      max-width: 420px;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.7);
      transform: scale(0);
      animation: scaleIn 0.3s forwards;
    }

    @keyframes scaleIn {
      from {
        transform: scale(0)
      }

      to {
        transform: scale(1)
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0
      }

      to {
        opacity: 1
      }
    }

    .star {
      font-size: 2.2rem;
      cursor: pointer;
      transition: all 0.3s;
    }

    .star.hovered,
    .star.selected {
      color: rgb(119, 0, 255);
      text-shadow: 0 0 10px rgb(119, 0, 255);
      transform: scale(1.3);
    }
  </style>
</head>

<body class="min-h-screen flex flex-col items-center p-6">
  <div class="w-full max-w-6xl">
    <h2 class="text-white text-4xl font-bold mb-8 text-center animate-pulse">Histórico de Compras</h2>
    <div id="history-wrap" class="text-gray-200"></div>
    <div class="mt-6 flex justify-center items-center">
      <a href="adm.html" class="button-back">Voltar</a>
    </div>
  </div>

  <!-- POPUP FEEDBACK -->
  <div id="popup-feedback">
    <div class="content">
      <h3 class="text-2xl font-bold mb-5 animate-bounce">Avalie sua compra</h3>
      <div id="stars" class="mb-6 flex justify-center gap-3">
        <span class="star" data-value="1">☆</span>
        <span class="star" data-value="2">☆</span>
        <span class="star" data-value="3">☆</span>
        <span class="star" data-value="4">☆</span>
        <span class="star" data-value="5">☆</span>
      </div>
      <button id="confirm-feedback"
        class="px-6 py-3 bg-orange-500 text-black rounded-lg font-bold hover:bg-orange-400 hover:scale-105 transition">Confirmar</button>
    </div>
  </div>

  <script>
    // ---------- HISTÓRICO ----------
    function loadHistory() {
      const history = JSON.parse(localStorage.getItem('compras_history') || '[]');
      const wrap = document.getElementById('history-wrap');
      wrap.innerHTML = '';

      if (history.length === 0) {
        wrap.innerHTML = `<div class="text-gray-400 text-center py-10 text-lg">Você não possui compras ainda.</div>`;
        return;
      }

      history.forEach((h, idx) => {
        const row = document.createElement('div');
        row.className = 'history-card animate-fadeIn';
        row.innerHTML = `
      <div class="flex justify-between items-start">
        <div>
          <div class="text-white font-bold text-xl mb-1">${h.nome} — Série: ${h.serie}</div>
          <div class="text-gray-300 mb-2">WhatsApp: ${h.whatsapp}</div>
        </div>
        <button class="button-red" onclick="removeHistory(${idx})">Remover</button>
      </div>
      <div class="mt-2 space-y-1">
        <div class="font-semibold text-orange-400">Compras:</div>
        <div>Produto: ${h.produto}</div>
        <div>Quantidade: ${h.quantidade}</div>
        <div>Valor Unitário: ${h.valorUnitario}</div>
        <div>Data: ${h.data}</div>
        <div class="mt-2">Avaliação: <span class="text-yellow-400">${h.avaliacao ? '★'.repeat(h.avaliacao) + '☆'.repeat(5 - h.avaliacao) : 'Não avaliado'}</span></div>
      </div>
    `;
        wrap.appendChild(row);
      });
    }

    function removeHistory(i) {
      const history = JSON.parse(localStorage.getItem('compras_history') || '[]');
      history.splice(i, 1);
      localStorage.setItem('compras_history', JSON.stringify(history));
      loadHistory();
    }

    // ---------- POPUP FEEDBACK ----------
    let currentPurchase = null;
    let avaliacao = 0;

    function showFeedback(purchase) {
      currentPurchase = purchase;
      avaliacao = 0;
      const popup = document.getElementById('popup-feedback');
      const stars = document.querySelectorAll('#stars .star');
      stars.forEach(s => s.classList.remove('selected', 'hovered'));
      popup.style.display = 'flex';

      stars.forEach(star => {
        star.onclick = () => {
          avaliacao = parseInt(star.dataset.value);
          updateStars();
        }
        star.onmouseover = () => {
          stars.forEach(s => s.classList.remove('hovered'));
          let val = parseInt(star.dataset.value);
          for (let i = 0; i < val; i++) stars[i].classList.add('hovered');
        }
        star.onmouseout = () => { stars.forEach(s => s.classList.remove('hovered')); updateStars(); }
      });
    }

    function updateStars() {
      const stars = document.querySelectorAll('#stars .star');
      stars.forEach((s, i) => {
        if (i < avaliacao) s.classList.add('selected');
        else s.classList.remove('selected');
      });
    }

    document.getElementById('confirm-feedback').onclick = () => {
      if (currentPurchase && avaliacao > 0) {
        const history = JSON.parse(localStorage.getItem('compras_history') || '[]');
        const idx = history.findIndex(h => h.data === currentPurchase.data && h.produto === currentPurchase.produto);
        if (idx >= 0) {
          history[idx].avaliacao = avaliacao;
          localStorage.setItem('compras_history', JSON.stringify(history));
          loadHistory();
        }
        document.getElementById('popup-feedback').style.display = 'none';
        currentPurchase = null;
      } else {
        alert('Selecione uma avaliação antes de confirmar.');
      }
    }

    // ---------- INIT ----------
    loadHistory();
  </script>
</body>

</html>